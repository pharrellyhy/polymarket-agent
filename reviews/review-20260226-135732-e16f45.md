# Consolidated Code Review (2026-02-26 13:57:32)

## Findings

### High

1. **File path and line number**: `src/polymarket_agent/cli.py:84` and `src/polymarket_agent/mcp_server.py:310`
   **Severity**: high
   **Category**: Diff
   **Description**: The `polymarket-agent mcp` command creates a new `FastMCP` instance via `create_server()` and runs it, but the MCP tools in `src/polymarket_agent/mcp_server.py` are registered on the module-level `mcp` instance through decorators. The newly created server instance therefore does not have those tools registered, which can cause MCP clients to fail with missing-method errors at runtime.
   **Suggested fix**: Return and run the tool-registered MCP instance (or ensure `create_server()` attaches/copies the decorated tools to the returned server). Prefer a single authoritative MCP server instance to avoid registry drift.

2. **File path and line number**: `src/polymarket_agent/orchestrator.py:37`
   **Severity**: high
   **Category**: Holistic
   **Description**: The orchestrator constructs `PaperTrader` directly and only uses `config.mode` to suppress execution in monitor mode. This collapses the declared mode abstraction (`paper`, `live`, `monitor`, `mcp`) and leaves no clean architectural path for executor selection, mode-specific guardrails, or injection of alternate executors.
   **Suggested fix**: Introduce an executor factory or dependency injection point keyed by `AppConfig.mode`, and keep mode semantics inside executor implementations (or a mode strategy) instead of scattered conditional checks in the orchestrator loop.

### Medium

3. **File path and line number**: `src/polymarket_agent/mcp_server.py:33`
   **Severity**: medium
   **Category**: Holistic
   **Description**: MCP handlers access orchestrator private attributes (`_strategies`, `_executor`, `_data`) directly. This tightly couples the MCP surface to orchestrator internals, increasing breakage risk during refactors and weakening the agent-facing API boundary.
   **Suggested fix**: Add public orchestrator methods for the MCP use cases (for example signal generation, manual order placement, active strategy listing, market access) and have MCP tools call those stable interfaces instead of private members.

4. **File path and line number**: `README.md` and `src/polymarket_agent/strategies/ai_analyst.py:25`
   **Severity**: medium
   **Category**: Holistic
   **Description**: The AI analyst strategy and related MCP AI analysis tool depend on `ANTHROPIC_API_KEY` (and the optional `anthropic` package), but operator documentation does not clearly describe these requirements, configuration expectations, or degraded behavior when unavailable.
   **Suggested fix**: Document `ANTHROPIC_API_KEY`, installation requirements for `anthropic`, and expected runtime behavior (including fallback/degradation) in `README.md` or an operator guide, including MCP tool availability implications.

## Summary

- Total issues: 4
- Severity breakdown: 0 critical, 2 high, 2 medium, 0 low
- Agents run:
  - Agent 1: Diff Review (uncommitted + recent commits)
  - Agent 2: Holistic Review (project structure and agent readiness)
- Deduplication result: No overlapping findings required merging
- Overall assessment: The most urgent issue is an MCP server wiring regression in the recent diff that can break MCP tool availability. The broader codebase is generally organized, but executor mode abstraction and MCP-to-orchestrator API boundaries need tightening to improve maintainability and agent-safe evolution.
